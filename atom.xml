<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>黑牛随笔</title>
  <icon>https://www.gravatar.com/avatar/46e1f3db99e2fa0758333d0897d8e925</icon>
  
  <link href="https://chenlingmin.github.io/atom.xml" rel="self"/>
  
  <link href="https://chenlingmin.github.io/"/>
  <updated>2022-02-25T06:23:08.532Z</updated>
  <id>https://chenlingmin.github.io/</id>
  
  <author>
    <name>黑牛</name>
    <email>chenlingmin.com@gmail.com</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>写诗有感</title>
    <link href="https://chenlingmin.github.io/2022/02/25/%E5%86%99%E8%AF%97%E6%9C%89%E6%84%9F/"/>
    <id>https://chenlingmin.github.io/2022/02/25/%E5%86%99%E8%AF%97%E6%9C%89%E6%84%9F/</id>
    <published>2022-02-25T01:44:55.000Z</published>
    <updated>2022-02-25T06:23:08.532Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="//unpkg.com/heti/umd/heti.min.css"><div class="heti heti--ancient"></br><p>早上，送夫人上班，在和她闲聊，聊到以后儿子写作的水平如何培养，此时正遇堵车，就问他如何描写堵车。由于我水平有限，路上思索着，拿《望洞庭》作为底稿，经过反复打磨后，才得一首打油诗。</p></br></div><div class="heti heti--poetry">  <h2>望长江大桥堵车有感</h2>  <p class="heti-x-large">    尾烟素月两相和，路无红灯车未挪。<span class="heti-hang"></span><br>    遥望大桥千里赤，长江漂浮一死蛇。<span class="heti-hang"></span><br>  </p></div><div class="heti heti--ancient"></br><p>发给夫人鉴赏后，夫人说：“笑死”，不一会，夫人就来了一首。</p></br></div><div class="heti heti--poetry">  <h2>望堵车</h2>  <p class="heti-x-large">    前路无红灯，油满车却停。<span class="heti-hang"></span><br>    夜黑汽更白，江上一条龙。<span class="heti-hang"></span><br>  </p></div><div class="heti heti--ancient"></br><p>我说不押韵，他回到：“这是香菱学诗”，我蹩脚的压了下韵律，改成了这样：</p></br></div><div class="heti heti--poetry">  <p class="heti-x-large">    信号灯曰行，油满车却停。<span class="heti-hang"></span><br>    夜黑汽更白，江上一蚯蚓。<span class="heti-hang"></span><br>  </p></div><div class="heti heti--ancient"></br><p>她又改道：</p></br></div><div class="heti heti--poetry">  <p class="heti-x-large">    路无红灯碍，油满车却停。<span class="heti-hang"></span><br>    夜黑汽更白，江上一蜻蜓。<span class="heti-hang"></span><br>  </p></div><div class="heti heti--ancient"></br><p>我一看，“路无红灯碍”似乎更好一点，于是基于此句，加上 <code>ai</code> 韵后得：</p></br></div><div class="heti heti--poetry">  <p class="heti-x-large">    路无红灯碍，尾红气更白。<span class="heti-hang"></span><br>    油满车不动，蜻蜓接我来。<span class="heti-hang"></span><br>  </p></div><div class="heti heti--ancient"></br><p>她看过后，把 “蜻蜓接我来” 改成 “警车开道来”：</p></br></div><div class="heti heti--poetry">  <p class="heti-x-large">    路无红灯碍，尾红气更白。<span class="heti-hang"></span><br>    油满车不动，警车开道来。<span class="heti-hang"></span><br>  </p></div><div class="heti heti--ancient"></br><p>就此定稿，我觉得还是第一首 “长江漂浮一死蛇” 会更好一点，主要是还没见过有人形容堵车是死蛇的，有点新意，但夫人的解说，让我觉得第二首，更有深意。</p><p>她如此解说道：“全诗表达了，作者对环境污浊的愤怒，自己明明能力满满，却寸步不行。警车开道一句，表达了作者期望遇到自己的明主与伯乐，满满的怀才不遇。”</p><p>从有想法，到成拙作，一直疲于形容堵车的词语与押韵上，却在夫人的过度解读或叫深入解读后，我自己都觉一新，可想而知，古往今来亦是如此。</p><p>另外，“打油诗”写完后，想到自己也会须臾忘却，可想而知，古人自己所写，亦会须臾忘却，故记录此文。</p></br></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; href=&quot;//unpkg.com/heti/umd/heti.min.css&quot;&gt;


&lt;div class=&quot;heti heti--ancient&quot;&gt;
&lt;/br&gt;

&lt;p&gt;早上，送夫人上班，在和她闲聊，聊到以后儿子写作的水平如何培养</summary>
      
    
    
    
    
    <category term="随笔" scheme="https://chenlingmin.github.io/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>表格驱动法优化ifelse</title>
    <link href="https://chenlingmin.github.io/2021/12/08/%E8%A1%A8%E6%A0%BC%E9%A9%B1%E5%8A%A8%E6%B3%95%E4%BC%98%E5%8C%96ifelse/"/>
    <id>https://chenlingmin.github.io/2021/12/08/%E8%A1%A8%E6%A0%BC%E9%A9%B1%E5%8A%A8%E6%B3%95%E4%BC%98%E5%8C%96ifelse/</id>
    <published>2021-12-08T02:44:55.000Z</published>
    <updated>2022-02-25T03:46:11.866Z</updated>
    
    <content type="html"><![CDATA[<h2 id="表格驱动的常见形式"><a href="#表格驱动的常见形式" class="headerlink" title="表格驱动的常见形式"></a>表格驱动的常见形式</h2><p>开发中，常常会用到各种分支逻辑，<code>if</code> <code>else</code>  <code>switch</code>  <code>case</code> 霸屏，如下代码。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (state == <span class="number">1</span>) &#123;</span><br><span class="line">    process1();</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == <span class="number">2</span>)&#123;</span><br><span class="line">    process2();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    processByDefault();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在编程的世界，只有两种元素组成，那就是数据与代码。像上面的代码，估计大家一看，除了 <code>state</code> 的 <code>&#123;1, 2...&#125;</code> 是数据的概念，其他的诸如 <code>if</code> <code>else</code> <code>process1()</code> <code>process2()</code> <code>processByDefault()</code> 自然也就化为代码的部分。</p><p>而代码和数据的划分，不是泾渭分明的，你写的任何代码，在编译器的角度，又成为了数据。</p><p>因此如果我们换一个角度思考上述代码，重新定义数据，可能就会得到另一个结果。 如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;Integer, Runnable&gt; stateProcessMap = <span class="keyword">new</span> HashMap&lt;&gt;&#123;&#123;</span><br><span class="line">    put(<span class="number">1</span>, <span class="keyword">this</span>::process1);</span><br><span class="line">    put(<span class="number">2</span>, <span class="keyword">this</span>::process1);</span><br><span class="line">&#125;&#125;;</span><br><span class="line"></span><br><span class="line">stateProcessMap.getOrDefault(state, <span class="keyword">this</span>::processByDefault).run();</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>提出了 <code>stateProcessMap</code> 的数据，表示 <code>state</code> 与业务的映射关系。</p><p>那数据的提出有什么好处呢？</p><p>显而易见的是，以后同类结构的修改，你不再是改 <code>if</code> <code>else</code> 代码的部分，而只需要修改 <code>stateProcessMap</code> 数据部分。</p><p>可不要小看这一点点小改动，虽然现在 stateProcessMap 概念是数据，而载体还是在代码上，但可是动静分离的基础。</p><h2 id="阶梯式的表格驱动"><a href="#阶梯式的表格驱动" class="headerlink" title="阶梯式的表格驱动"></a>阶梯式的表格驱动</h2><p>在常见形式中，key 一般为静态的数据，能够用在 <code>if (x == xx)</code> 等于的部分，而如果面对如下的代码，可能又得继续思考了。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (distance &gt; <span class="number">3</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.avg3();   </span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (distance &gt; <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.avg2();</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (distance &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.avg1();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.avg();   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上述逻辑，由于是阶梯式的逻辑，必须先从最大的数开始判断，所以无法使用常规的形式，你可以这样重新定义数据，如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] distanceLevels = &#123;<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>&#125;;</span><br><span class="line">Supplier[] avgLevels = &#123;<span class="keyword">this</span>::avg3, <span class="keyword">this</span>.avg2, <span class="keyword">this</span>.avg1&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; distanceLevels.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (distanceLevels[i] &gt; state) &#123;</span><br><span class="line">        <span class="keyword">return</span> avgLevels[i].get();</span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.avg(); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上述形式，我们称为阶梯访问表，虽然不如常见形式简介，但也达到了分离了数据与代码的效果，取得了更高的扩展性。</p><h2 id="NavigableMap-在表格驱动中阶梯逻辑的使用"><a href="#NavigableMap-在表格驱动中阶梯逻辑的使用" class="headerlink" title="NavigableMap 在表格驱动中阶梯逻辑的使用"></a>NavigableMap 在表格驱动中阶梯逻辑的使用</h2><p>在上述的阶梯访问表中，也存在几个问题:</p><ul><li> 大量数据时，存在线性访问，查找成本较大</li><li> 需要手工保证 key -&gt; value  的映射</li></ul><p>应运而生的，我们想到可以使用 TreeMap，即是 key -&gt; value 的结构，又是有序的结构。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NavigableMap&lt;Integer, Supplier&gt; distanceAvgMap = <span class="keyword">new</span> TreeMap&lt;&gt; &#123;&#123;</span><br><span class="line">    put(<span class="number">1</span>, <span class="keyword">this</span>::avg1);</span><br><span class="line">    put(<span class="number">2</span>, <span class="keyword">this</span>::avg2);</span><br><span class="line">    put(<span class="number">3</span>, <span class="keyword">this</span>::avg3);</span><br><span class="line">&#125;&#125;;</span><br><span class="line"></span><br><span class="line">distanceAvgMap.lowerEntry(distance).getValue().get();</span><br></pre></td></tr></table></figure><p><code>NavigableMap</code> 是一个可导航的 <code>Map</code> 接口, 上层接口为 <code>SortedMap</code>，顶层接口为 <code>Map</code>，<code>TreeMap</code> 是 <code>NavigableMap</code> 的具体实现，是一个平衡二叉树的实现，主流的实现是八股文中的红黑树，其中 <code>lowerEntry(key)</code> 是以二分查找法查找一个小于或等于 <code>key</code> 的 <code>Entry</code>。</p><p>这样，我们阶梯式的逻辑，就用一个二叉树的 <code>Map</code> 数据结构表示成了数据形式，与阶梯访问表相比，更优雅的达到了数据与代码分离的效果。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;表格驱动的常见形式&quot;&gt;&lt;a href=&quot;#表格驱动的常见形式&quot; class=&quot;headerlink&quot; title=&quot;表格驱动的常见形式&quot;&gt;&lt;/a&gt;表格驱动的常见形式&lt;/h2&gt;&lt;p&gt;开发中，常常会用到各种分支逻辑，&lt;code&gt;if&lt;/code&gt; &lt;code&gt;else</summary>
      
    
    
    
    
    <category term="编码技巧" scheme="https://chenlingmin.github.io/tags/%E7%BC%96%E7%A0%81%E6%8A%80%E5%B7%A7/"/>
    
  </entry>
  
  <entry>
    <title>为Mybatis提供spring-data一致的分页API</title>
    <link href="https://chenlingmin.github.io/2021/12/07/%E4%B8%BAMybatis%E6%8F%90%E4%BE%9Bspring-data%E4%B8%80%E8%87%B4%E7%9A%84%E5%88%86%E9%A1%B5API/"/>
    <id>https://chenlingmin.github.io/2021/12/07/%E4%B8%BAMybatis%E6%8F%90%E4%BE%9Bspring-data%E4%B8%80%E8%87%B4%E7%9A%84%E5%88%86%E9%A1%B5API/</id>
    <published>2021-12-07T08:44:55.000Z</published>
    <updated>2021-12-08T06:00:34.045Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><code>spring-data</code> 项目中，为数据访问提供熟悉且一致的基于 Spring 的编程模型，同时仍保留底层数据存储的特殊特性，其中 <code>spring-data-jpa</code> 更容易实践领域驱动设计的特性，尤其收开发者欢迎。</p><p>然而，面对一些比较复杂的连表查询，如果严格按照 CQRS 的方案实践，方案又会显得比较笨重。在这个背景下， jpa 与 Mybatis 的混合方案，分别发挥了 jpa 模型的长处 与 Mybatis 动态 SQL 的长处，而规避了 jpa<br>动态 SQL 的短处与 Mybatis 模型的短处，受到了广泛的一致认可。</p><p>方案特点表现如下：</p><ul><li>Jpa 做模型的持久操作，以及单表查询。</li><li>Mybatis 只做视图的复杂查询，并且不参与业务逻辑的运算（即代替 CQRS 查询层的逻辑）。</li></ul><h2 id="Mybatis-PageHelper-的实践"><a href="#Mybatis-PageHelper-的实践" class="headerlink" title="Mybatis PageHelper 的实践"></a>Mybatis PageHelper 的实践</h2><p>在 <code>spring-data</code> 的中，提供了分页排序的 API 基本都是如下形状：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Iterable&lt;T&gt; <span class="title">findAll</span><span class="params">(Predicate predicate, Sort sort)</span></span>;</span><br><span class="line"><span class="function">Page&lt;T&gt; <span class="title">findAll</span><span class="params">(Predicate predicate, Pageable pageable)</span></span>;</span><br></pre></td></tr></table></figure><p>为了让 Mybatis 提供与 <code>spring-data</code> 一致的 API，我们希望使用如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line"><span class="keyword">public</span> Page&lt;OrderQueryMapper.OrderView&gt;findAll(OrderQueryMapper.OrderParam orderParam, Pageable pageable)&#123;   </span><br><span class="line">    <span class="keyword">return</span> orderQueryMapper.findAll(orderParam, pageable);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>于是，我们的 Mapper 查询层利用 page-helper 做了如下设计：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderQueryMapper</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function">List&lt;OrderView&gt; <span class="title">findAll</span><span class="params">(OrderParam orderParam)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">default</span> List&lt;OrderView&gt; <span class="title">findAll</span><span class="params">(OrderParam param, Sort sort)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueryHelper.sort(<span class="keyword">this</span>::findAll, param, sort);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> Page&lt;OrderView&gt; <span class="title">findAll</span><span class="params">(OrderParam param, Pageable pageable)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueryHelper.page(<span class="keyword">this</span>::findAll, param, pageable);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">OrderParam</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String orderId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">QueryHelper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mapperMethod 查询方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> param        查询参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pageable     分页参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;RESULT&gt;     结果类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;PARAM&gt;      参数类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;RESULT, PARAM&gt; <span class="function">Page&lt;RESULT&gt; <span class="title">page</span><span class="params">(Function&lt;PARAM, List&lt;RESULT&gt;&gt; mapperMethod, PARAM param, Pageable pageable)</span> </span>&#123;</span><br><span class="line">        String orderBy = Optional.of(pageable.getSort())</span><br><span class="line">                .map(Iterable::spliterator)</span><br><span class="line">                .map(i -&gt; StreamSupport.stream(i, <span class="keyword">false</span>))</span><br><span class="line">                .orElseGet(Stream::empty)</span><br><span class="line">                .map(a -&gt; a.getProperty() + <span class="string">&quot; &quot;</span> + a.getDirection().name())</span><br><span class="line">                .collect(Collectors.joining(<span class="string">&quot;,&quot;</span>));</span><br><span class="line">        <span class="comment">// 注意 pageHelper 的 pageNum 从 1 开始</span></span><br><span class="line">        PageHelper.startPage(pageable.getPageNumber() + <span class="number">1</span>, pageable.getPageSize(), orderBy);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            com.github.pagehelper.Page&lt;RESULT&gt; result = (com.github.pagehelper.Page&lt;RESULT&gt;) mapperMethod.apply(param);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> PageImpl&lt;&gt;(result.getResult(), pageable, result.getTotal());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            PageHelper.clearPage();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mapperMethod 查询方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> param        查询参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sort         排序参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;RESULT&gt;     结果类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;PARAM&gt;      参数类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;RESULT, PARAM&gt; <span class="function">List&lt;RESULT&gt; <span class="title">sort</span><span class="params">(Function&lt;PARAM, List&lt;RESULT&gt;&gt; mapperMethod, PARAM param, Sort sort)</span> </span>&#123;</span><br><span class="line">        String orderBy = Optional.ofNullable(sort)</span><br><span class="line">                .map(Iterable::spliterator)</span><br><span class="line">                .map(i -&gt; StreamSupport.stream(i, <span class="keyword">false</span>))</span><br><span class="line">                .orElseGet(Stream::empty)</span><br><span class="line">                .map(a -&gt; a.getProperty() + <span class="string">&quot; &quot;</span> + a.getDirection().name())</span><br><span class="line">                .collect(Collectors.joining(<span class="string">&quot;,&quot;</span>));</span><br><span class="line">        PageHelper.orderBy(orderBy);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> mapperMethod.apply(param);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            PageHelper.clearPage();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;&lt;code&gt;spring-data&lt;/code&gt; 项目中，为数据访问提供熟悉且一致的基于 Spring 的编程模型，同时仍保留底层数据存储的</summary>
      
    
    
    
    
    <category term="编码技巧" scheme="https://chenlingmin.github.io/tags/%E7%BC%96%E7%A0%81%E6%8A%80%E5%B7%A7/"/>
    
    <category term="Mybatis" scheme="https://chenlingmin.github.io/tags/Mybatis/"/>
    
    <category term="spring-data" scheme="https://chenlingmin.github.io/tags/spring-data/"/>
    
  </entry>
  
  <entry>
    <title>关于枚举的高级用法</title>
    <link href="https://chenlingmin.github.io/2021/12/07/%E6%9E%9A%E4%B8%BE%E7%9A%84%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/"/>
    <id>https://chenlingmin.github.io/2021/12/07/%E6%9E%9A%E4%B8%BE%E7%9A%84%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/</id>
    <published>2021-12-07T08:34:55.000Z</published>
    <updated>2022-02-25T03:47:21.821Z</updated>
    
    <content type="html"><![CDATA[<h1 id="关于枚举的高级用法"><a href="#关于枚举的高级用法" class="headerlink" title="关于枚举的高级用法"></a>关于枚举的高级用法</h1><h2 id="枚举回顾"><a href="#枚举回顾" class="headerlink" title="枚举回顾"></a>枚举回顾</h2><p>Java 中的枚举，大家都不会陌生，他的一些特点，能让我们得心应手的实现业务逻辑。</p><ul><li>它的单例特性，我们就可以直接使用 <code>==</code> 来做逻辑校验，如:</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Gender</span> </span>&#123;</span><br><span class="line">   MAN, WOMAN;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (Gender.MAN == gender) &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>也可以直接实现一个线程单例，JVM 层面提供的保障</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleEnumDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">SingleEn</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        INSTANCE;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SingleEn.INSTANCE.setName(<span class="string">&quot;zp&quot;</span>);</span><br><span class="line">        System.out.println(SingleEn.INSTANCE.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>还能校验参数是否非法，使用 <code>valueOf</code> 方法</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Gender</span> </span>&#123;</span><br><span class="line">   MAN, WOMAN;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">null</span> == Gender.valueOf(<span class="string">&quot;xxxxx&quot;</span>)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>当然最常见的，还是定义各种状态，似乎觉得枚举天生就是这样用的</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">ShareRuleEnum</span> </span>&#123;</span><br><span class="line">    REDPACKET(<span class="string">&quot;店鋪紅包&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    MANJIAN(<span class="string">&quot;滿減優惠&quot;</span>, <span class="number">2</span>),</span><br><span class="line">    MANZENG(<span class="string">&quot;滿贈活動&quot;</span>, <span class="number">4</span>),</span><br><span class="line">    ZHEKOU(<span class="string">&quot;折扣商品&quot;</span>, <span class="number">8</span>),</span><br><span class="line">    ;</span><br><span class="line">    <span class="keyword">private</span> String shareRuleName;</span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="枚举使用的其他案例"><a href="#枚举使用的其他案例" class="headerlink" title="枚举使用的其他案例"></a>枚举使用的其他案例</h2><p>某个场景，需要一个查询的接口，查询的参数有时间区间，即开始时间~结束时间。自然我们会想到，定义两个请求参数 <code>start</code> 、<code>end</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> MsgResult&lt;XXXResult&gt; <span class="title">get</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="meta">@RequestParam</span> Date start, <span class="meta">@RequestParam</span> Date end</span></span></span><br><span class="line"><span class="params"><span class="function">)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在这个场景上，附加上了一个规则，只能使用给定的时间区间（如：今天，昨天，本月，上月…），这时大家应该能想到枚举又有用武之地了，例如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> MsgResult&lt;XXXResult&gt; <span class="title">get</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@RequestParam</span> DateRangeEnum dateRange</span></span></span><br><span class="line"><span class="params"><span class="function">)</span> </span>&#123;</span><br><span class="line">    Date start, end;</span><br><span class="line">    <span class="keyword">if</span> (dateRange == TODAY) &#123;</span><br><span class="line">        start = ..., end = ...;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">DateRangeEnum</span> </span>&#123;</span><br><span class="line">    TODAY, YESTEDAY, CURRENT_MONTH, LAST_MONTH;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>等等……</p><p>思考一下，我们为什么要定义枚举？<br>是为了要约束入参的范围，这个枚举确实做到了部分，因为只能传递 <code>TODAY</code>，<code>YESTEDAY</code>, <code>CURRENT_MONTH</code>, <code>LAST_MONTH</code>。</p><p>但这些枚举值所代表的含义是什么呢？例如 <code>TODAY</code> 是希望 <code>start</code> 为今天的开始，<code>end</code> 为明天的开始（闭区间）</p><p>然而这些代码却没有在 <code>DateRangeEnum</code> 类里面体现，而写在了其他方法里面。</p><p>由此我们得出结论，我们提供的 <code>DateRangeEnum</code> 类表达的意思不全的，是残缺的，最起码现在看来残缺了时间区间的表达。</p><p>改进一版，提供一个时间区间的接口（面向接口编程），以及一个普通 Bean 的实现。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">DateRange</span> </span>&#123;</span><br><span class="line">    <span class="function">Date <span class="title">getStart</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">Date <span class="title">getEnd</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DateRangeParam</span> <span class="keyword">implements</span> <span class="title">DateRange</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Date start;</span><br><span class="line">    <span class="keyword">private</span> Date end;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>改造枚举 <code>DateRangeEnum</code>, 让他能够产生时间区间，我们就利用 Java8 已经定义好了接口 <code>Supplier</code>，让 <code>DateRangeEnum</code> 实现该接口。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> MsgResult&lt;XXXResult&gt; <span class="title">get</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@RequestParam</span> DateRangeEnum dateRange</span></span></span><br><span class="line"><span class="params"><span class="function">)</span> </span>&#123;</span><br><span class="line">    DateRange range = dateRange.get();</span><br><span class="line">    range.getStart();</span><br><span class="line">    range.getEnd();</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">DateRangeEnum</span> <span class="keyword">implements</span> <span class="title">Supplier</span>&lt;<span class="title">DateRange</span>&gt; </span>&#123;</span><br><span class="line">    TODAY &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> DateRange <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            Date now = <span class="keyword">new</span> Date();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> DateRangeParam(</span><br><span class="line">                    truncate(now, Calendar.DATE),</span><br><span class="line">                    addDays(truncate(now, Calendar.DATE), <span class="number">1</span>)</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    YESTERDAY &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> DateRange <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            Date now = <span class="keyword">new</span> Date();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> DateRangeParam(</span><br><span class="line">                    addDays(truncate(now, Calendar.DATE), -<span class="number">1</span>),</span><br><span class="line">                    truncate(now, Calendar.DATE)</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...省略本月、上月的实现...</span></span><br><span class="line">    ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样，枚举中就包含了时间区间的含义了，通过调用枚举的 <code>get</code> 方法，如 <code>TODAY.get()</code> ，就能获取时间区间 <code>DateRange</code> 了。</p><p>这就是枚举的高级用法，『高级』其实指的不是技术上的高级，无非是实现了接口而已，而是把枚举需要表达的含义（如 <code>TODAY</code> 要表达的含义是今天到明天）表达清楚、表达完整。</p><h2 id="进阶"><a href="#进阶" class="headerlink" title="进阶"></a>进阶</h2><p>🤔以上代码还有什么问题么？例如如何进行单元测试？</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;关于枚举的高级用法&quot;&gt;&lt;a href=&quot;#关于枚举的高级用法&quot; class=&quot;headerlink&quot; title=&quot;关于枚举的高级用法&quot;&gt;&lt;/a&gt;关于枚举的高级用法&lt;/h1&gt;&lt;h2 id=&quot;枚举回顾&quot;&gt;&lt;a href=&quot;#枚举回顾&quot; class=&quot;headerli</summary>
      
    
    
    
    
    <category term="编码技巧" scheme="https://chenlingmin.github.io/tags/%E7%BC%96%E7%A0%81%E6%8A%80%E5%B7%A7/"/>
    
  </entry>
  
  <entry>
    <title>从“白马非马”到“协变、逆变”</title>
    <link href="https://chenlingmin.github.io/2019/11/03/%E4%BB%8E%E2%80%9C%E7%99%BD%E9%A9%AC%E9%9D%9E%E9%A9%AC%E2%80%9D%E5%88%B0%E2%80%9C%E5%8D%8F%E5%8F%98%E3%80%81%E9%80%86%E5%8F%98%E2%80%9D/"/>
    <id>https://chenlingmin.github.io/2019/11/03/%E4%BB%8E%E2%80%9C%E7%99%BD%E9%A9%AC%E9%9D%9E%E9%A9%AC%E2%80%9D%E5%88%B0%E2%80%9C%E5%8D%8F%E5%8F%98%E3%80%81%E9%80%86%E5%8F%98%E2%80%9D/</id>
    <published>2019-11-03T04:44:55.000Z</published>
    <updated>2021-12-08T06:24:50.323Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一段哲学辩论"><a href="#一段哲学辩论" class="headerlink" title="一段哲学辩论"></a>一段哲学辩论</h2><p>据说，公孙龙有一次需要过关, 关吏只允许人通过，于是有了下面的辩论。</p><p>关吏：”按照惯例，过关人可以，但马不行。”</p><p>公孙龙：”我的是白马，不是马。”</p><p>关吏：”白马怎么能不是马呢？”</p><p>公孙龙：”‘马’是对物’形’方面的规定，’白马’则是对马’色’方面的规定，对’色’方面的规定与对’形’方面的规定，自然是不同的，所以说，对不同的概念加以不同规定的结果，白马与马也是不同的。”</p><p>关吏：”有了白马，就不可以说没有马。既然不可以说没有马，那么白马不就是马了么？既然有白马称为有马，那么为什么白色的马就不是马呢？”</p><p>公孙龙：”如果你要求得到’马’，黄马、黑马都可以满足要求；如果要求得到白马，黄马、黑马就不能满足要求了。假如白马就是马，那么要求得到马与要求得到白马便完全一样了，这就表明白马与马不一样，所以白马非马。”</p><p>…略 公孙龙成功过关…</p><p>在这个故事中，我们常人的理解，就如关吏一样，马是包含了白马、黄马、黑马……，所以我们认为白马是马</p><p>而公孙龙的角度则是，区分出白马的’形’与’色’，分析出他们在不同的场景下，不一样的性质。</p><?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="138px" preserveAspectRatio="none" style="width:403px;height:138px;background:#FFFFFF;" version="1.1" viewBox="0 0 403 138" width="403px" zoomAndPan="magnify"><defs/><g><!--MD5=[ced20fe0d287375d25d243599fc4d6cf]class Horse--><rect codeLine="18" fill="#FFFFFF" height="32" id="Horse" style="stroke:#FF0066;stroke-width:1.5;" width="69" x="165" y="99"/><ellipse cx="180" cy="115" fill="#FFEBF3" rx="11" ry="11" style="stroke:#FF0066;stroke-width:1.0;"/><path d="M176.9063,113.3906 L178.9219,117.6563 L180.4688,117.6563 L182.3594,113.3906 L182.3594,118.2969 L181.7656,118.2969 C181.3125,118.2969 181.2031,118.3125 181.0469,118.4219 C180.7969,118.5781 180.6406,118.8594 180.6406,119.1563 C180.6406,119.4063 180.7656,119.6719 181,119.8281 C181.125,119.9531 181.375,120 181.7656,120 L183.9688,120 C184.3125,120 184.5625,119.9531 184.6875,119.875 C184.9375,119.7188 185.0938,119.4375 185.0938,119.1563 C185.0938,118.6094 184.7188,118.2969 184.0469,118.2969 L184.0469,111.7813 C184.6094,111.7344 184.9375,111.4375 184.9375,110.9375 C184.9375,110.6719 184.7969,110.4063 184.5938,110.2344 C184.4219,110.125 184.2813,110.0938 183.8125,110.0938 L181.9531,110.0938 L179.6563,115.1406 L177.3125,110.0938 L175.4531,110.0938 C175.4375,110.0781 175.4219,110.0781 175.3906,110.0781 C175.1875,110.0781 174.8281,110.1406 174.7344,110.1875 C174.4844,110.3594 174.3281,110.6563 174.3281,110.9219 C174.3281,111.4375 174.6563,111.7344 175.2188,111.7813 L175.2188,118.2969 C174.5469,118.2969 174.1719,118.6094 174.1719,119.1563 C174.1719,119.4219 174.3125,119.6719 174.5313,119.8281 C174.6875,119.9531 174.9063,120 175.3125,120 L177.5156,120 C177.8438,120 178.1094,119.9531 178.2188,119.875 C178.4844,119.7188 178.625,119.4375 178.625,119.1563 C178.625,118.875 178.5156,118.625 178.2969,118.4531 C178.1094,118.3281 177.9688,118.2969 177.5156,118.2969 L176.9063,118.2969 L176.9063,113.3906 Z " fill="#000000"/><text fill="#3B0018" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="37" x="194" y="119.1543">Horse</text><!--MD5=[90a0a161ab6003eb8100bc54898200c2]class WhiteHorse--><rect codeLine="20" fill="#FFFFFF" height="32" id="WhiteHorse" style="stroke:#FF0066;stroke-width:1.5;" width="103" x="7" y="7"/><ellipse cx="22" cy="23" fill="#FFEBF3" rx="11" ry="11" style="stroke:#FF0066;stroke-width:1.0;"/><path d="M18.9063,21.3906 L20.9219,25.6563 L22.4688,25.6563 L24.3594,21.3906 L24.3594,26.2969 L23.7656,26.2969 C23.3125,26.2969 23.2031,26.3125 23.0469,26.4219 C22.7969,26.5781 22.6406,26.8594 22.6406,27.1563 C22.6406,27.4063 22.7656,27.6719 23,27.8281 C23.125,27.9531 23.375,28 23.7656,28 L25.9688,28 C26.3125,28 26.5625,27.9531 26.6875,27.875 C26.9375,27.7188 27.0938,27.4375 27.0938,27.1563 C27.0938,26.6094 26.7188,26.2969 26.0469,26.2969 L26.0469,19.7813 C26.6094,19.7344 26.9375,19.4375 26.9375,18.9375 C26.9375,18.6719 26.7969,18.4063 26.5938,18.2344 C26.4219,18.125 26.2813,18.0938 25.8125,18.0938 L23.9531,18.0938 L21.6563,23.1406 L19.3125,18.0938 L17.4531,18.0938 C17.4375,18.0781 17.4219,18.0781 17.3906,18.0781 C17.1875,18.0781 16.8281,18.1406 16.7344,18.1875 C16.4844,18.3594 16.3281,18.6563 16.3281,18.9219 C16.3281,19.4375 16.6563,19.7344 17.2188,19.7813 L17.2188,26.2969 C16.5469,26.2969 16.1719,26.6094 16.1719,27.1563 C16.1719,27.4219 16.3125,27.6719 16.5313,27.8281 C16.6875,27.9531 16.9063,28 17.3125,28 L19.5156,28 C19.8438,28 20.1094,27.9531 20.2188,27.875 C20.4844,27.7188 20.625,27.4375 20.625,27.1563 C20.625,26.875 20.5156,26.625 20.2969,26.4531 C20.1094,26.3281 19.9688,26.2969 19.5156,26.2969 L18.9063,26.2969 L18.9063,21.3906 Z " fill="#000000"/><text fill="#3B0018" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="71" x="36" y="27.1543">WhiteHorse</text><!--MD5=[aaed7e7a0d00fb5555758e1b9c1da84d]class BlackHourse--><rect codeLine="21" fill="#FFFFFF" height="32" id="BlackHourse" style="stroke:#FF0066;stroke-width:1.5;" width="108" x="145.5" y="7"/><ellipse cx="160.5" cy="23" fill="#FFEBF3" rx="11" ry="11" style="stroke:#FF0066;stroke-width:1.0;"/><path d="M157.4063,21.3906 L159.4219,25.6563 L160.9688,25.6563 L162.8594,21.3906 L162.8594,26.2969 L162.2656,26.2969 C161.8125,26.2969 161.7031,26.3125 161.5469,26.4219 C161.2969,26.5781 161.1406,26.8594 161.1406,27.1563 C161.1406,27.4063 161.2656,27.6719 161.5,27.8281 C161.625,27.9531 161.875,28 162.2656,28 L164.4688,28 C164.8125,28 165.0625,27.9531 165.1875,27.875 C165.4375,27.7188 165.5938,27.4375 165.5938,27.1563 C165.5938,26.6094 165.2188,26.2969 164.5469,26.2969 L164.5469,19.7813 C165.1094,19.7344 165.4375,19.4375 165.4375,18.9375 C165.4375,18.6719 165.2969,18.4063 165.0938,18.2344 C164.9219,18.125 164.7813,18.0938 164.3125,18.0938 L162.4531,18.0938 L160.1563,23.1406 L157.8125,18.0938 L155.9531,18.0938 C155.9375,18.0781 155.9219,18.0781 155.8906,18.0781 C155.6875,18.0781 155.3281,18.1406 155.2344,18.1875 C154.9844,18.3594 154.8281,18.6563 154.8281,18.9219 C154.8281,19.4375 155.1563,19.7344 155.7188,19.7813 L155.7188,26.2969 C155.0469,26.2969 154.6719,26.6094 154.6719,27.1563 C154.6719,27.4219 154.8125,27.6719 155.0313,27.8281 C155.1875,27.9531 155.4063,28 155.8125,28 L158.0156,28 C158.3438,28 158.6094,27.9531 158.7188,27.875 C158.9844,27.7188 159.125,27.4375 159.125,27.1563 C159.125,26.875 159.0156,26.625 158.7969,26.4531 C158.6094,26.3281 158.4688,26.2969 158.0156,26.2969 L157.4063,26.2969 L157.4063,21.3906 Z " fill="#000000"/><text fill="#3B0018" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="76" x="174.5" y="27.1543">BlackHourse</text><!--MD5=[18ca4d4cc06ef75fbc60bd83e7a4e4bd]class YellowHorse--><rect codeLine="22" fill="#FFFFFF" height="32" id="YellowHorse" style="stroke:#FF0066;stroke-width:1.5;" width="108" x="288.5" y="7"/><ellipse cx="303.5" cy="23" fill="#FFEBF3" rx="11" ry="11" style="stroke:#FF0066;stroke-width:1.0;"/><path d="M300.4063,21.3906 L302.4219,25.6563 L303.9688,25.6563 L305.8594,21.3906 L305.8594,26.2969 L305.2656,26.2969 C304.8125,26.2969 304.7031,26.3125 304.5469,26.4219 C304.2969,26.5781 304.1406,26.8594 304.1406,27.1563 C304.1406,27.4063 304.2656,27.6719 304.5,27.8281 C304.625,27.9531 304.875,28 305.2656,28 L307.4688,28 C307.8125,28 308.0625,27.9531 308.1875,27.875 C308.4375,27.7188 308.5938,27.4375 308.5938,27.1563 C308.5938,26.6094 308.2188,26.2969 307.5469,26.2969 L307.5469,19.7813 C308.1094,19.7344 308.4375,19.4375 308.4375,18.9375 C308.4375,18.6719 308.2969,18.4063 308.0938,18.2344 C307.9219,18.125 307.7813,18.0938 307.3125,18.0938 L305.4531,18.0938 L303.1563,23.1406 L300.8125,18.0938 L298.9531,18.0938 C298.9375,18.0781 298.9219,18.0781 298.8906,18.0781 C298.6875,18.0781 298.3281,18.1406 298.2344,18.1875 C297.9844,18.3594 297.8281,18.6563 297.8281,18.9219 C297.8281,19.4375 298.1563,19.7344 298.7188,19.7813 L298.7188,26.2969 C298.0469,26.2969 297.6719,26.6094 297.6719,27.1563 C297.6719,27.4219 297.8125,27.6719 298.0313,27.8281 C298.1875,27.9531 298.4063,28 298.8125,28 L301.0156,28 C301.3438,28 301.6094,27.9531 301.7188,27.875 C301.9844,27.7188 302.125,27.4375 302.125,27.1563 C302.125,26.875 302.0156,26.625 301.7969,26.4531 C301.6094,26.3281 301.4688,26.2969 301.0156,26.2969 L300.4063,26.2969 L300.4063,21.3906 Z " fill="#000000"/><text fill="#3B0018" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="76" x="317.5" y="27.1543">YellowHorse</text><!--MD5=[b4761fb272ab9bd816d8e08fb4d06bb8]link WhiteHorse to Horse--><path codeLine="24" d="M58.5,39.0252 C58.5,65.3838 58.5,115 58.5,115 C58.5,115 144.646,115 144.646,115 " fill="none" id="WhiteHorse-to-Horse" style="stroke:#FF0066;stroke-width:1.0;"/><polygon fill="none" points="144.646,107.9999,164.646,115,144.646,121.9999,144.646,107.9999" style="stroke:#FF0066;stroke-width:1.0;"/><!--MD5=[a3c8b59944043a012a80012a5cb41430]link YellowHorse to Horse--><path codeLine="25" d="M342.5,39.0252 C342.5,65.3838 342.5,115 342.5,115 C342.5,115 254.116,115 254.116,115 " fill="none" id="YellowHorse-to-Horse" style="stroke:#FF0066;stroke-width:1.0;"/><polygon fill="none" points="254.116,121.9999,234.116,115,254.116,107.9999,254.116,121.9999" style="stroke:#FF0066;stroke-width:1.0;"/><!--MD5=[0775a66c677e0a9132dcd1ffb54c9060]link BlackHourse to Horse--><path codeLine="26" d="M199.5,39.0252 C199.5,39.0252 199.5,78.8498 199.5,78.8498 " fill="none" id="BlackHourse-to-Horse" style="stroke:#FF0066;stroke-width:1.0;"/><polygon fill="none" points="206.5,78.8498,199.5,98.8498,192.5,78.8497,206.5,78.8498" style="stroke:#FF0066;stroke-width:1.0;"/><!--MD5=[a2582a1d9f681050328928f9f05109e8]@startuml!define entity(x, desc) class "desc" as x << (M,#ffebf3)  >>'left to right directionskinparam classFontColor #3b0018skinparam classArrowColor #ff0066skinparam classBorderColor #ff0066skinparam classBackgroundColor ##f6f4eeskinparam shadowing false'skinparam linetype polylineskinparam linetype orthohide methodshide stereotypeshide fieldentity(Horse, 'Horse')entity(WhiteHorse, 'WhiteHorse')entity(BlackHourse, 'BlackHourse')entity(YellowHorse, 'YellowHorse')WhiteHorse - -|> HorseYellowHorse - -|> HorseBlackHourse - -|> Horse@enduml@startumlskinparam classFontColor #3b0018skinparam classArrowColor #ff0066skinparam classBorderColor #ff0066skinparam classBackgroundColor ##f6f4eeskinparam shadowing falseskinparam linetype orthohide methodshide stereotypeshide fieldclass "Horse" as Horse << (M,#ffebf3)  >>class "WhiteHorse" as WhiteHorse << (M,#ffebf3)  >>class "BlackHourse" as BlackHourse << (M,#ffebf3)  >>class "YellowHorse" as YellowHorse << (M,#ffebf3)  >>WhiteHorse - -|> HorseYellowHorse - -|> HorseBlackHourse - -|> Horse@endumlPlantUML version 1.2021.16beta3(Unknown compile time)(GPL source distribution)Java Runtime: Java(TM) SE Runtime EnvironmentJVM: Java HotSpot(TM) 64-Bit Server VMDefault Encoding: UTF-8Language: enCountry: US--></g></svg><h2 id="协变与逆变"><a href="#协变与逆变" class="headerlink" title="协变与逆变"></a>协变与逆变</h2><p>对象的继承关系，是面对对象设计思想的精髓所在，例如下列代码大家肯定不陌生，这表示了白马是马的子类。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Horse</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WhiteHorse</span> <span class="keyword">extends</span> <span class="title">Horse</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YellowHorse</span> <span class="keyword">extends</span> <span class="title">Horse</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlackHourse</span> <span class="keyword">extends</span> <span class="title">Horse</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Horse horse = <span class="keyword">new</span> WhiteHorse();</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这总自然“和谐”的关系转变，就称为协变。</p><p>在 <code>java</code> 中，数组是协变的，但会存在一些问题，如下列代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Horse[] horses = <span class="keyword">new</span> WhiteHorse[<span class="number">10</span>]; </span><br><span class="line">horses[<span class="number">0</span>] = <span class="keyword">new</span> WhiteHorse();</span><br><span class="line">horses[<span class="number">1</span>] = <span class="keyword">new</span> BlackHourse(); <span class="comment">// 编译通过，运行时报错</span></span><br></pre></td></tr></table></figure><p>而泛型是不变的，如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Horse&gt; horseList = <span class="keyword">new</span> ArrayList&lt;Hourse&gt;(); <span class="comment">// 正常</span></span><br><span class="line">List&lt;Horse&gt; horseList = <span class="keyword">new</span> ArrayList&lt;WhiteHorse&gt;(); <span class="comment">// 编译报错</span></span><br></pre></td></tr></table></figure><h3 id="extends-关键字"><a href="#extends-关键字" class="headerlink" title="extends 关键字"></a>extends 关键字</h3><p>在 <code>java</code> 中，如果需要泛型实现协变，可以使用 extends 关键字:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">List&lt;? extends Horse&gt; horseList = <span class="keyword">new</span> ArrayList&lt;WhiteHorse&gt;();</span><br><span class="line"></span><br><span class="line">Horse horse = horseList.get(<span class="number">0</span>); <span class="comment">// 白马是马 （运行会报数组越界）</span></span><br><span class="line"></span><br><span class="line">horseList.add(<span class="keyword">new</span> WhiteHorse()); <span class="comment">// 白马非马 编译报错</span></span><br></pre></td></tr></table></figure><p>上述代码中，<code>horseList</code> 是协变的，白马的所有元素，都被认为是马，也就是白马是马的体现。</p><p>然而调用 <code>add(new WhiteHorse())</code> 却无法编译，又体现出了白马非马的特点。</p><p>原因在于 <code>List&lt;? extends Horse&gt;</code> 也可以向合法指向的 <code>List&lt;BlackHourse&gt;</code>，显然里面放 <code>WhiteHorse</code> 是非法的，编译器不知道<code>List&lt;? extends Horse&gt;</code>的所持有的具体类型是什么，所以一旦转型，就将丢失向其中消费对象的能力，而只保留了向外提供对象的能力。</p><p>在 <code>kotlin</code> 中，放弃了 <code>java</code> 的 <code>extends</code> 关键字的使用，而使用 <code>out</code> 更具语意的词汇，来表达协变的关系转换，只保留了向外提供对象的能力。</p><?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="141px" preserveAspectRatio="none" style="width:471px;height:141px;background:#FFFFFF;" version="1.1" viewBox="0 0 471 141" width="471px" zoomAndPan="magnify"><defs/><g><!--MD5=[ced20fe0d287375d25d243599fc4d6cf]class Horse--><rect codeLine="18" fill="#FFFFFF" height="32" id="Horse" style="stroke:#FF0066;stroke-width:1.5;" width="152" x="156.5" y="102"/><ellipse cx="171.5" cy="118" fill="#FFEBF3" rx="11" ry="11" style="stroke:#FF0066;stroke-width:1.0;"/><path d="M168.4063,116.3906 L170.4219,120.6563 L171.9688,120.6563 L173.8594,116.3906 L173.8594,121.2969 L173.2656,121.2969 C172.8125,121.2969 172.7031,121.3125 172.5469,121.4219 C172.2969,121.5781 172.1406,121.8594 172.1406,122.1563 C172.1406,122.4063 172.2656,122.6719 172.5,122.8281 C172.625,122.9531 172.875,123 173.2656,123 L175.4688,123 C175.8125,123 176.0625,122.9531 176.1875,122.875 C176.4375,122.7188 176.5938,122.4375 176.5938,122.1563 C176.5938,121.6094 176.2188,121.2969 175.5469,121.2969 L175.5469,114.7813 C176.1094,114.7344 176.4375,114.4375 176.4375,113.9375 C176.4375,113.6719 176.2969,113.4063 176.0938,113.2344 C175.9219,113.125 175.7813,113.0938 175.3125,113.0938 L173.4531,113.0938 L171.1563,118.1406 L168.8125,113.0938 L166.9531,113.0938 C166.9375,113.0781 166.9219,113.0781 166.8906,113.0781 C166.6875,113.0781 166.3281,113.1406 166.2344,113.1875 C165.9844,113.3594 165.8281,113.6563 165.8281,113.9219 C165.8281,114.4375 166.1563,114.7344 166.7188,114.7813 L166.7188,121.2969 C166.0469,121.2969 165.6719,121.6094 165.6719,122.1563 C165.6719,122.4219 165.8125,122.6719 166.0313,122.8281 C166.1875,122.9531 166.4063,123 166.8125,123 L169.0156,123 C169.3438,123 169.6094,122.9531 169.7188,122.875 C169.9844,122.7188 170.125,122.4375 170.125,122.1563 C170.125,121.875 170.0156,121.625 169.7969,121.4531 C169.6094,121.3281 169.4688,121.2969 169.0156,121.2969 L168.4063,121.2969 L168.4063,116.3906 Z " fill="#000000"/><text fill="#3B0018" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="20" x="185.5" y="122.1543">List</text><rect fill="#FFFFFF" height="15.9688" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" width="98" x="213.5" y="99"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="96" x="214.5" y="111.1387">? extends Horse</text><!--MD5=[90a0a161ab6003eb8100bc54898200c2]class WhiteHorse--><rect codeLine="20" fill="#FFFFFF" height="32" id="WhiteHorse" style="stroke:#FF0066;stroke-width:1.5;" width="125" x="7" y="10"/><ellipse cx="22" cy="26" fill="#FFEBF3" rx="11" ry="11" style="stroke:#FF0066;stroke-width:1.0;"/><path d="M18.9063,24.3906 L20.9219,28.6563 L22.4688,28.6563 L24.3594,24.3906 L24.3594,29.2969 L23.7656,29.2969 C23.3125,29.2969 23.2031,29.3125 23.0469,29.4219 C22.7969,29.5781 22.6406,29.8594 22.6406,30.1563 C22.6406,30.4063 22.7656,30.6719 23,30.8281 C23.125,30.9531 23.375,31 23.7656,31 L25.9688,31 C26.3125,31 26.5625,30.9531 26.6875,30.875 C26.9375,30.7188 27.0938,30.4375 27.0938,30.1563 C27.0938,29.6094 26.7188,29.2969 26.0469,29.2969 L26.0469,22.7813 C26.6094,22.7344 26.9375,22.4375 26.9375,21.9375 C26.9375,21.6719 26.7969,21.4063 26.5938,21.2344 C26.4219,21.125 26.2813,21.0938 25.8125,21.0938 L23.9531,21.0938 L21.6563,26.1406 L19.3125,21.0938 L17.4531,21.0938 C17.4375,21.0781 17.4219,21.0781 17.3906,21.0781 C17.1875,21.0781 16.8281,21.1406 16.7344,21.1875 C16.4844,21.3594 16.3281,21.6563 16.3281,21.9219 C16.3281,22.4375 16.6563,22.7344 17.2188,22.7813 L17.2188,29.2969 C16.5469,29.2969 16.1719,29.6094 16.1719,30.1563 C16.1719,30.4219 16.3125,30.6719 16.5313,30.8281 C16.6875,30.9531 16.9063,31 17.3125,31 L19.5156,31 C19.8438,31 20.1094,30.9531 20.2188,30.875 C20.4844,30.7188 20.625,30.4375 20.625,30.1563 C20.625,29.875 20.5156,29.625 20.2969,29.4531 C20.1094,29.3281 19.9688,29.2969 19.5156,29.2969 L18.9063,29.2969 L18.9063,24.3906 Z " fill="#000000"/><text fill="#3B0018" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="20" x="36" y="30.1543">List</text><rect fill="#FFFFFF" height="15.9688" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" width="71" x="64" y="7"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="69" x="65" y="19.1387">WhiteHorse</text><!--MD5=[aaed7e7a0d00fb5555758e1b9c1da84d]class BlackHourse--><rect codeLine="21" fill="#FFFFFF" height="32" id="BlackHourse" style="stroke:#FF0066;stroke-width:1.5;" width="130" x="167.5" y="10"/><ellipse cx="182.5" cy="26" fill="#FFEBF3" rx="11" ry="11" style="stroke:#FF0066;stroke-width:1.0;"/><path d="M179.4063,24.3906 L181.4219,28.6563 L182.9688,28.6563 L184.8594,24.3906 L184.8594,29.2969 L184.2656,29.2969 C183.8125,29.2969 183.7031,29.3125 183.5469,29.4219 C183.2969,29.5781 183.1406,29.8594 183.1406,30.1563 C183.1406,30.4063 183.2656,30.6719 183.5,30.8281 C183.625,30.9531 183.875,31 184.2656,31 L186.4688,31 C186.8125,31 187.0625,30.9531 187.1875,30.875 C187.4375,30.7188 187.5938,30.4375 187.5938,30.1563 C187.5938,29.6094 187.2188,29.2969 186.5469,29.2969 L186.5469,22.7813 C187.1094,22.7344 187.4375,22.4375 187.4375,21.9375 C187.4375,21.6719 187.2969,21.4063 187.0938,21.2344 C186.9219,21.125 186.7813,21.0938 186.3125,21.0938 L184.4531,21.0938 L182.1563,26.1406 L179.8125,21.0938 L177.9531,21.0938 C177.9375,21.0781 177.9219,21.0781 177.8906,21.0781 C177.6875,21.0781 177.3281,21.1406 177.2344,21.1875 C176.9844,21.3594 176.8281,21.6563 176.8281,21.9219 C176.8281,22.4375 177.1563,22.7344 177.7188,22.7813 L177.7188,29.2969 C177.0469,29.2969 176.6719,29.6094 176.6719,30.1563 C176.6719,30.4219 176.8125,30.6719 177.0313,30.8281 C177.1875,30.9531 177.4063,31 177.8125,31 L180.0156,31 C180.3438,31 180.6094,30.9531 180.7188,30.875 C180.9844,30.7188 181.125,30.4375 181.125,30.1563 C181.125,29.875 181.0156,29.625 180.7969,29.4531 C180.6094,29.3281 180.4688,29.2969 180.0156,29.2969 L179.4063,29.2969 L179.4063,24.3906 Z " fill="#000000"/><text fill="#3B0018" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="20" x="196.5" y="30.1543">List</text><rect fill="#FFFFFF" height="15.9688" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" width="76" x="224.5" y="7"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="74" x="225.5" y="19.1387">BlackHourse</text><!--MD5=[18ca4d4cc06ef75fbc60bd83e7a4e4bd]class YellowHorse--><rect codeLine="22" fill="#FFFFFF" height="32" id="YellowHorse" style="stroke:#FF0066;stroke-width:1.5;" width="127" x="333" y="10"/><ellipse cx="348" cy="26" fill="#FFEBF3" rx="11" ry="11" style="stroke:#FF0066;stroke-width:1.0;"/><path d="M344.9063,24.3906 L346.9219,28.6563 L348.4688,28.6563 L350.3594,24.3906 L350.3594,29.2969 L349.7656,29.2969 C349.3125,29.2969 349.2031,29.3125 349.0469,29.4219 C348.7969,29.5781 348.6406,29.8594 348.6406,30.1563 C348.6406,30.4063 348.7656,30.6719 349,30.8281 C349.125,30.9531 349.375,31 349.7656,31 L351.9688,31 C352.3125,31 352.5625,30.9531 352.6875,30.875 C352.9375,30.7188 353.0938,30.4375 353.0938,30.1563 C353.0938,29.6094 352.7188,29.2969 352.0469,29.2969 L352.0469,22.7813 C352.6094,22.7344 352.9375,22.4375 352.9375,21.9375 C352.9375,21.6719 352.7969,21.4063 352.5938,21.2344 C352.4219,21.125 352.2813,21.0938 351.8125,21.0938 L349.9531,21.0938 L347.6563,26.1406 L345.3125,21.0938 L343.4531,21.0938 C343.4375,21.0781 343.4219,21.0781 343.3906,21.0781 C343.1875,21.0781 342.8281,21.1406 342.7344,21.1875 C342.4844,21.3594 342.3281,21.6563 342.3281,21.9219 C342.3281,22.4375 342.6563,22.7344 343.2188,22.7813 L343.2188,29.2969 C342.5469,29.2969 342.1719,29.6094 342.1719,30.1563 C342.1719,30.4219 342.3125,30.6719 342.5313,30.8281 C342.6875,30.9531 342.9063,31 343.3125,31 L345.5156,31 C345.8438,31 346.1094,30.9531 346.2188,30.875 C346.4844,30.7188 346.625,30.4375 346.625,30.1563 C346.625,29.875 346.5156,29.625 346.2969,29.4531 C346.1094,29.3281 345.9688,29.2969 345.5156,29.2969 L344.9063,29.2969 L344.9063,24.3906 Z " fill="#000000"/><text fill="#3B0018" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="20" x="362" y="30.1543">List</text><rect fill="#FFFFFF" height="15.9688" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" width="73" x="390" y="7"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="71" x="391" y="19.1387">YellowHorse</text><!--MD5=[b4761fb272ab9bd816d8e08fb4d06bb8]link WhiteHorse to Horse--><path codeLine="24" d="M132.223,26 C148.72,26 162,26 162,26 C162,26 162,81.9748 162,81.9748 " fill="none" id="WhiteHorse-to-Horse" style="stroke:#FF0066;stroke-width:1.0;"/><polygon fill="none" points="169,81.9749,162,101.9748,155,81.9748,169,81.9749" style="stroke:#FF0066;stroke-width:1.0;"/><!--MD5=[a3c8b59944043a012a80012a5cb41430]link YellowHorse to Horse--><path codeLine="25" d="M332.841,26 C316.286,26 303,26 303,26 C303,26 303,81.9748 303,81.9748 " fill="none" id="YellowHorse-to-Horse" style="stroke:#FF0066;stroke-width:1.0;"/><polygon fill="none" points="310,81.9749,303,101.9748,296,81.9748,310,81.9749" style="stroke:#FF0066;stroke-width:1.0;"/><!--MD5=[0775a66c677e0a9132dcd1ffb54c9060]link BlackHourse to Horse--><path codeLine="26" d="M232.5,42.0252 C232.5,42.0252 232.5,81.8498 232.5,81.8498 " fill="none" id="BlackHourse-to-Horse" style="stroke:#FF0066;stroke-width:1.0;"/><polygon fill="none" points="239.5,81.8498,232.5,101.8498,225.5,81.8497,239.5,81.8498" style="stroke:#FF0066;stroke-width:1.0;"/><!--MD5=[f513c2e7a7e30385717a213b60fddfa3]@startuml!define entity(x, desc) class "desc" as x << (M,#ffebf3)  >>'left to right directionskinparam classFontColor #3b0018skinparam classArrowColor #ff0066skinparam classBorderColor #ff0066skinparam classBackgroundColor ##f6f4eeskinparam shadowing false'skinparam linetype polylineskinparam linetype orthohide methodshide stereotypeshide fieldentity(Horse, 'List<? extends Horse>')entity(WhiteHorse, 'List<WhiteHorse>')entity(BlackHourse, 'List<BlackHourse>')entity(YellowHorse, 'List<YellowHorse>')WhiteHorse - -|> HorseYellowHorse - -|> HorseBlackHourse - -|> Horse@enduml@startumlskinparam classFontColor #3b0018skinparam classArrowColor #ff0066skinparam classBorderColor #ff0066skinparam classBackgroundColor ##f6f4eeskinparam shadowing falseskinparam linetype orthohide methodshide stereotypeshide fieldclass "List<? extends Horse>" as Horse << (M,#ffebf3)  >>class "List<WhiteHorse>" as WhiteHorse << (M,#ffebf3)  >>class "List<BlackHourse>" as BlackHourse << (M,#ffebf3)  >>class "List<YellowHorse>" as YellowHorse << (M,#ffebf3)  >>WhiteHorse - -|> HorseYellowHorse - -|> HorseBlackHourse - -|> Horse@endumlPlantUML version 1.2021.16beta3(Unknown compile time)(GPL source distribution)Java Runtime: Java(TM) SE Runtime EnvironmentJVM: Java HotSpot(TM) 64-Bit Server VMDefault Encoding: UTF-8Language: enCountry: US--></g></svg><h3 id="逆变与-super-关键字的回顾"><a href="#逆变与-super-关键字的回顾" class="headerlink" title="逆变与 super 关键字的回顾"></a>逆变与 super 关键字的回顾</h3><p>与之对应的是，逆变，在 <code>java</code> 中，如果需要泛型实现逆变，可以使用 <code>super</code> 关键字:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">List&lt;? <span class="keyword">super</span> WhiteHorse&gt; horseList = <span class="keyword">new</span> ArrayList&lt;Horse&gt;();</span><br><span class="line"></span><br><span class="line">horseList.add(<span class="keyword">new</span> WhiteHorse()); </span><br><span class="line"></span><br><span class="line">WhiteHorse horse = horseList.get(<span class="number">0</span>); <span class="comment">// 编译报错，类型无法转换</span></span><br><span class="line">Horse horse = horseList.get(<span class="number">0</span>); <span class="comment">// 编译报错，类型无法转换</span></span><br><span class="line">Object object= horseList.get(<span class="number">0</span>); <span class="comment">// 编译通过</span></span><br></pre></td></tr></table></figure><p>上述代码中，<code>horseList</code> 是逆变的，<code>List&lt;? super WhiteHorse&gt;</code> 可以合法的指向所有的 <code>WhiteHorse</code> 父类的集合，显然里面放入 <code>WhiteHorse</code> 是正常的，因为所有能消费处理 <code>WhiteHorse</code> 父类的，肯定能消费处理 <code>WhiteHorse</code>；但是向外提供的对象，则无法确定，只能退化到根类 <code>Object</code>，也就是丢失了向外提供对象的能力，而只保留了消费对象的能力。</p><p>在 <code>kotlin</code> 中，放弃了 <code>java</code> 的 <code>super</code> 关键字的使用，而使用与 <code>out</code> 对应的 <code>in</code> 更具语意的词汇，来表达逆变的关系转换，只保留了消费对象的能力。</p><?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="233px" preserveAspectRatio="none" style="width:191px;height:233px;background:#FFFFFF;" version="1.1" viewBox="0 0 191 233" width="191px" zoomAndPan="magnify"><defs/><g><!--MD5=[aa7f586532e18719e6cefa70fc650583]class Object--><rect codeLine="17" fill="#FFFFFF" height="32" id="Object" style="stroke:#FF0066;stroke-width:1.5;" width="95" x="46" y="194"/><ellipse cx="61" cy="210" fill="#FFEBF3" rx="11" ry="11" style="stroke:#FF0066;stroke-width:1.0;"/><path d="M57.9063,208.3906 L59.9219,212.6563 L61.4688,212.6563 L63.3594,208.3906 L63.3594,213.2969 L62.7656,213.2969 C62.3125,213.2969 62.2031,213.3125 62.0469,213.4219 C61.7969,213.5781 61.6406,213.8594 61.6406,214.1563 C61.6406,214.4063 61.7656,214.6719 62,214.8281 C62.125,214.9531 62.375,215 62.7656,215 L64.9688,215 C65.3125,215 65.5625,214.9531 65.6875,214.875 C65.9375,214.7188 66.0938,214.4375 66.0938,214.1563 C66.0938,213.6094 65.7188,213.2969 65.0469,213.2969 L65.0469,206.7813 C65.6094,206.7344 65.9375,206.4375 65.9375,205.9375 C65.9375,205.6719 65.7969,205.4063 65.5938,205.2344 C65.4219,205.125 65.2813,205.0938 64.8125,205.0938 L62.9531,205.0938 L60.6563,210.1406 L58.3125,205.0938 L56.4531,205.0938 C56.4375,205.0781 56.4219,205.0781 56.3906,205.0781 C56.1875,205.0781 55.8281,205.1406 55.7344,205.1875 C55.4844,205.3594 55.3281,205.6563 55.3281,205.9219 C55.3281,206.4375 55.6563,206.7344 56.2188,206.7813 L56.2188,213.2969 C55.5469,213.2969 55.1719,213.6094 55.1719,214.1563 C55.1719,214.4219 55.3125,214.6719 55.5313,214.8281 C55.6875,214.9531 55.9063,215 56.3125,215 L58.5156,215 C58.8438,215 59.1094,214.9531 59.2188,214.875 C59.4844,214.7188 59.625,214.4375 59.625,214.1563 C59.625,213.875 59.5156,213.625 59.2969,213.4531 C59.1094,213.3281 58.9688,213.2969 58.5156,213.2969 L57.9063,213.2969 L57.9063,208.3906 Z " fill="#000000"/><text fill="#3B0018" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="20" x="75" y="214.1543">List</text><rect fill="#FFFFFF" height="15.9688" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" width="41" x="103" y="191"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="39" x="104" y="203.1387">Object</text><!--MD5=[ced20fe0d287375d25d243599fc4d6cf]class Horse--><rect codeLine="18" fill="#FFFFFF" height="32" id="Horse" style="stroke:#FF0066;stroke-width:1.5;" width="90" x="48.5" y="102"/><ellipse cx="63.5" cy="118" fill="#FFEBF3" rx="11" ry="11" style="stroke:#FF0066;stroke-width:1.0;"/><path d="M60.4063,116.3906 L62.4219,120.6563 L63.9688,120.6563 L65.8594,116.3906 L65.8594,121.2969 L65.2656,121.2969 C64.8125,121.2969 64.7031,121.3125 64.5469,121.4219 C64.2969,121.5781 64.1406,121.8594 64.1406,122.1563 C64.1406,122.4063 64.2656,122.6719 64.5,122.8281 C64.625,122.9531 64.875,123 65.2656,123 L67.4688,123 C67.8125,123 68.0625,122.9531 68.1875,122.875 C68.4375,122.7188 68.5938,122.4375 68.5938,122.1563 C68.5938,121.6094 68.2188,121.2969 67.5469,121.2969 L67.5469,114.7813 C68.1094,114.7344 68.4375,114.4375 68.4375,113.9375 C68.4375,113.6719 68.2969,113.4063 68.0938,113.2344 C67.9219,113.125 67.7813,113.0938 67.3125,113.0938 L65.4531,113.0938 L63.1563,118.1406 L60.8125,113.0938 L58.9531,113.0938 C58.9375,113.0781 58.9219,113.0781 58.8906,113.0781 C58.6875,113.0781 58.3281,113.1406 58.2344,113.1875 C57.9844,113.3594 57.8281,113.6563 57.8281,113.9219 C57.8281,114.4375 58.1563,114.7344 58.7188,114.7813 L58.7188,121.2969 C58.0469,121.2969 57.6719,121.6094 57.6719,122.1563 C57.6719,122.4219 57.8125,122.6719 58.0313,122.8281 C58.1875,122.9531 58.4063,123 58.8125,123 L61.0156,123 C61.3438,123 61.6094,122.9531 61.7188,122.875 C61.9844,122.7188 62.125,122.4375 62.125,122.1563 C62.125,121.875 62.0156,121.625 61.7969,121.4531 C61.6094,121.3281 61.4688,121.2969 61.0156,121.2969 L60.4063,121.2969 L60.4063,116.3906 Z " fill="#000000"/><text fill="#3B0018" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="20" x="77.5" y="122.1543">List</text><rect fill="#FFFFFF" height="15.9688" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" width="36" x="105.5" y="99"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="34" x="106.5" y="111.1387">Horse</text><!--MD5=[90a0a161ab6003eb8100bc54898200c2]class WhiteHorse--><rect codeLine="19" fill="#FFFFFF" height="32" id="WhiteHorse" style="stroke:#FF0066;stroke-width:1.5;" width="173" x="7" y="10"/><ellipse cx="22" cy="26" fill="#FFEBF3" rx="11" ry="11" style="stroke:#FF0066;stroke-width:1.0;"/><path d="M18.9063,24.3906 L20.9219,28.6563 L22.4688,28.6563 L24.3594,24.3906 L24.3594,29.2969 L23.7656,29.2969 C23.3125,29.2969 23.2031,29.3125 23.0469,29.4219 C22.7969,29.5781 22.6406,29.8594 22.6406,30.1563 C22.6406,30.4063 22.7656,30.6719 23,30.8281 C23.125,30.9531 23.375,31 23.7656,31 L25.9688,31 C26.3125,31 26.5625,30.9531 26.6875,30.875 C26.9375,30.7188 27.0938,30.4375 27.0938,30.1563 C27.0938,29.6094 26.7188,29.2969 26.0469,29.2969 L26.0469,22.7813 C26.6094,22.7344 26.9375,22.4375 26.9375,21.9375 C26.9375,21.6719 26.7969,21.4063 26.5938,21.2344 C26.4219,21.125 26.2813,21.0938 25.8125,21.0938 L23.9531,21.0938 L21.6563,26.1406 L19.3125,21.0938 L17.4531,21.0938 C17.4375,21.0781 17.4219,21.0781 17.3906,21.0781 C17.1875,21.0781 16.8281,21.1406 16.7344,21.1875 C16.4844,21.3594 16.3281,21.6563 16.3281,21.9219 C16.3281,22.4375 16.6563,22.7344 17.2188,22.7813 L17.2188,29.2969 C16.5469,29.2969 16.1719,29.6094 16.1719,30.1563 C16.1719,30.4219 16.3125,30.6719 16.5313,30.8281 C16.6875,30.9531 16.9063,31 17.3125,31 L19.5156,31 C19.8438,31 20.1094,30.9531 20.2188,30.875 C20.4844,30.7188 20.625,30.4375 20.625,30.1563 C20.625,29.875 20.5156,29.625 20.2969,29.4531 C20.1094,29.3281 19.9688,29.2969 19.5156,29.2969 L18.9063,29.2969 L18.9063,24.3906 Z " fill="#000000"/><text fill="#3B0018" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="20" x="36" y="30.1543">List</text><rect fill="#FFFFFF" height="15.9688" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" width="119" x="64" y="7"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="117" x="65" y="19.1387">? super WhiteHorse</text><!--MD5=[b4761fb272ab9bd816d8e08fb4d06bb8]link WhiteHorse to Horse--><path codeLine="21" d="M93.5,42.025 C93.5,42.025 93.5,81.85 93.5,81.85 " fill="none" id="WhiteHorse-to-Horse" style="stroke:#FF0066;stroke-width:1.0;"/><polygon fill="none" points="100.5001,81.85,93.5,101.85,86.5001,81.85,100.5001,81.85" style="stroke:#FF0066;stroke-width:1.0;"/><!--MD5=[8ce3136e4592d0a072bdbfb430254f52]link Horse to Object--><path codeLine="22" d="M93.5,134.0252 C93.5,134.0252 93.5,173.8498 93.5,173.8498 " fill="none" id="Horse-to-Object" style="stroke:#FF0066;stroke-width:1.0;"/><polygon fill="none" points="100.5001,173.8498,93.5,193.8498,86.5001,173.8497,100.5001,173.8498" style="stroke:#FF0066;stroke-width:1.0;"/><!--MD5=[0c4b7d767701e1ea0be0cc2fa876a1df]@startuml!define entity(x, desc) class "desc" as x << (M,#ffebf3)  >>'left to right directionskinparam classFontColor #3b0018skinparam classArrowColor #ff0066skinparam classBorderColor #ff0066skinparam classBackgroundColor ##f6f4eeskinparam shadowing false'skinparam linetype polylineskinparam linetype orthohide methodshide stereotypeshide fieldentity(Object, 'List<Object>')entity(Horse, 'List<Horse>')entity(WhiteHorse, 'List<? super WhiteHorse>')WhiteHorse - -|> HorseHorse - -|> Object@enduml@startumlskinparam classFontColor #3b0018skinparam classArrowColor #ff0066skinparam classBorderColor #ff0066skinparam classBackgroundColor ##f6f4eeskinparam shadowing falseskinparam linetype orthohide methodshide stereotypeshide fieldclass "List<Object>" as Object << (M,#ffebf3)  >>class "List<Horse>" as Horse << (M,#ffebf3)  >>class "List<? super WhiteHorse>" as WhiteHorse << (M,#ffebf3)  >>WhiteHorse - -|> HorseHorse - -|> Object@endumlPlantUML version 1.2021.16beta3(Unknown compile time)(GPL source distribution)Java Runtime: Java(TM) SE Runtime EnvironmentJVM: Java HotSpot(TM) 64-Bit Server VMDefault Encoding: UTF-8Language: enCountry: US--></g></svg><h2 id="回顾白马非马"><a href="#回顾白马非马" class="headerlink" title="回顾白马非马"></a>回顾白马非马</h2><p>在公孙龙的辩论中，他的论点为，如果你要求得到’马’，黄马、黑马都可以满足要求；如果要求得到白马，黄马、黑马就不能满足要求了。假如白马就是马，那么要求得到马与要求得到白马便完全一样了，这就表明白马与马不一样，所以白马非马。</p><p>他正是站在了协变不能消费对象的角度，表达了白马非马的观点。</p><h2 id="扩展阅读"><a href="#扩展阅读" class="headerlink" title="扩展阅读"></a>扩展阅读</h2><ul><li><a href="https://baike.baidu.com/item/%E7%99%BD%E9%A9%AC%E9%9D%9E%E9%A9%AC/464">白马非马</a></li><li><a href="https://zh.wikipedia.org/wiki/%E5%8D%8F%E5%8F%98%E4%B8%8E%E9%80%86%E5%8F%98">协变与逆变</a></li><li><a href="https://www.kotlincn.net/docs/reference/generics.html">kotlin 中的泛型</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;一段哲学辩论&quot;&gt;&lt;a href=&quot;#一段哲学辩论&quot; class=&quot;headerlink&quot; title=&quot;一段哲学辩论&quot;&gt;&lt;/a&gt;一段哲学辩论&lt;/h2&gt;&lt;p&gt;据说，公孙龙有一次需要过关, 关吏只允许人通过，于是有了下面的辩论。&lt;/p&gt;
&lt;p&gt;关吏：”按照惯例，过关人</summary>
      
    
    
    
    
    <category term="思考" scheme="https://chenlingmin.github.io/tags/%E6%80%9D%E8%80%83/"/>
    
    <category term="泛型" scheme="https://chenlingmin.github.io/tags/%E6%B3%9B%E5%9E%8B/"/>
    
    <category term="java" scheme="https://chenlingmin.github.io/tags/java/"/>
    
    <category term="面向对象" scheme="https://chenlingmin.github.io/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/"/>
    
  </entry>
  
</feed>
